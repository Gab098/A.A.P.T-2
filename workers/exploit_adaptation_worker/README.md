# üí• Exploit Adaptation Worker

The `exploit_adaptation_worker` is a critical component of the A.A.P.T. framework's Autonomous Exploit Chain Generation and Execution System. Its primary function is to dynamically adapt and execute exploits against identified vulnerabilities, aiming to achieve deeper compromise of target systems. This worker leverages LLMs to intelligently select and configure exploit modules, then executes them using tools like Metasploit.

## ‚ú® Features

*   **LLM-Driven Exploit Adaptation**: Utilizes the LLM Router to receive dynamic exploit parameters based on vulnerability and target context.
*   **Metasploit Integration**: Executes Metasploit modules with adapted parameters.
*   **Outcome Verification**: Attempts to verify exploit success (e.g., session creation).
*   **Standardized Output**: Publishes detailed exploit results, including success status and any access gained, to the `results_queue` following the A.A.P.T. standardized JSON schema.
*   **Configurable LHOST/LPORT**: Allows setting listener host and port for reverse shells via environment variables.

## ‚öôÔ∏è How it Works

1.  **Task Reception**: The worker listens on the `exploit_adaptation_tasks` RabbitMQ queue for new tasks, typically triggered by the `orchestrator` after a high-priority vulnerability has been identified.
2.  **LLM Interaction**: Upon receiving a task (containing vulnerability and target details), the worker queries the `LLMRouterClient` to get recommendations for the best exploit module, payload, and any specific options.
3.  **Exploit Execution**: The worker constructs and executes a Metasploit command (via `msfconsole`) using the LLM-provided parameters.
4.  **Result Processing**: The output of the exploit attempt is parsed to determine success (e.g., if a session was created).
5.  **Result Publication**: A detailed result message, including the exploit's success status, details of the exploit attempt, and any access gained, is published to the `results_queue`.

## üöÄ Getting Started

### Prerequisites

*   **RabbitMQ**: A running RabbitMQ instance accessible by the worker.
*   **Neo4j**: A running Neo4j instance for state management.
*   **LLM Router**: A running LLM Router service (`http://llm-router:8082` by default) accessible by the worker.
*   **Metasploit Framework**: `msfconsole` must be installed and accessible within the worker's environment. (Note: Integrating Metasploit into a Docker image can be complex and may require a specialized base image or a multi-stage build process. For development, ensure `msfconsole` is in the PATH of the container.)

### Configuration

Set the following environment variables for the worker:

```bash
# RabbitMQ Connection
RABBITMQ_HOST=rabbitmq
RABBITMQ_USER=aapt_user
RABBITMQ_PASS=your_secure_rabbitmq_password_here

# Neo4j Connection (for StateManager client if used directly, though orchestrator handles this)
NEO4J_URI=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASS=your_secure_neo4j_password_here

# LLM Router URL
LLM_ROUTER_URL=http://llm-router:8082

# Listener Host and Port for Reverse Shells (if applicable)
AAPT_LHOST=127.0.0.1 # Or your external IP
AAPT_LPORT=4444
```

### Running the Worker (Docker)

To build and run the worker using Docker:

```bash
# Navigate to the A.A.P.T. root directory
cd AAPT/aapt_framework/workers/exploit_adaptation_worker

# Build the Docker image
docker build -t aapt-exploit-adaptation-worker .

# Run the container (example, adjust environment variables as needed)
docker run -d \
  --name aapt-exploit-adaptation-worker \
  -e RABBITMQ_HOST=your_rabbitmq_host \
  -e RABBITMQ_USER=your_rabbitmq_user \
  -e RABBITMQ_PASS=your_rabbitmq_pass \
  -e LLM_ROUTER_URL=http://your_llm_router_host:8082 \
  -e AAPT_LHOST=your_listener_ip \
  -e AAPT_LPORT=your_listener_port \
  aapt-exploit-adaptation-worker
```

For integration with the full A.A.P.T. system, refer to the `docker-compose.yml` and `k8s/workers.yaml` configurations in the main framework documentation.

## üì¶ Dependencies

The worker relies on the following Python packages:

*   `pika`
*   `requests`

These are listed in `requirements.txt`.

## üìà Healthcheck

The worker does not expose a direct HTTP healthcheck endpoint. Its operational status can be monitored by observing its logs and the successful processing of messages in the RabbitMQ queues.

## üìù License

This project is open source. See the main A.A.P.T. framework `LICENSE` file for details.
