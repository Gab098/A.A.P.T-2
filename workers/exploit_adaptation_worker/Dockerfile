# Use an official Python runtime as a parent image
FROM python:3.9-slim-buster

# Set the working directory in the container
WORKDIR /app

# Install system dependencies required for pika, requests, and Metasploit
# This assumes Metasploit is installed in the base image or handled separately.
# For a real deployment, Metasploit installation would be complex and likely
# require a dedicated base image or a multi-stage build.
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    git \
    # Add any other dependencies for Metasploit if installing here
    # For example, if using a pre-built Metasploit, ensure its dependencies are met.
    && rm -rf /var/lib/apt/lists/*

# Copy the current directory contents into the container at /app
COPY requirements.txt .
COPY main.py .
COPY ../../core/ ./core/ # Copy the entire core directory into /app/core/

# Install any needed packages specified in requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Metasploit setup (placeholder - actual setup is complex)
# If Metasploit is not pre-installed, this section would be much more involved.
# For demonstration, we assume msfconsole is available in the environment.
# In a real scenario, you might mount a Metasploit installation or use a specialized image.
# For now, we'll just ensure the /tmp directory exists for RC scripts.
RUN mkdir -p /tmp

# Run main.py when the container launches
CMD ["python", "main.py"]
